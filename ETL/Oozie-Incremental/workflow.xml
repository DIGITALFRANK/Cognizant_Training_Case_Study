
<!-- 2.2 Functional Requirements â€“ ETL of Data -->
<!-- 2.2.4 Incremental Workflow Automation with Oozie -->
<!-- Create a Oozie workflow that will automate the process of importing only new data into the HDFS,  -->
<!-- Hive should then load only that new data into it's tables and original data should remain untouched -->
<!-- Modify the Oozie Coordinator to use this workflow -->







<!-- I'm gonna edit all this code!!  I think -->







<?xml version="1.0" encoding="UTF-8"?>

<workflow-app xmlns = "uri:oozie:workflow:0.2" name = "copy data from external to orc">
    <start to="sqoop-node"/>  

    <action name="sqoop-node">    <!--node name--> 
        <sqoop xmlns="uri:oozie:sqoop-action:0.2">
            <job-tracker>${jobTracker}</job-tracker>  <!--job tracking node is http://sandbox.hortonworks.com:8050 which is define in job properties--> 
            <name-node>${nameNode}</name-node> <!--name node is hdfs://sandbox.hortonworks.com:8020 which is defined in job properties--> 
            <prepare>
                <delete path="${nameNode}/user/maria_dev/Credit_Card_System"/>
            </prepare>
 
            <configuration>
                <property>
                    <name>mapred.job.queue.name</name>
                    <value>${queueName}</value> <!-- queue name is default and is defined in job properties -->
                </property>
            </configuration>
            <command>
                job --meta-connect jdbc:hsqldb:hsql://localhost:16000/sqoop --exec branch_import
                job --meta-connect jdbc:hsqldb:hsql://localhost:16000/sqoop --exec credit_card_import
                job --meta-connect jdbc:hsqldb:hsql://localhost:16000/sqoop --exec time_import
                job --meta-connect jdbc:hsqldb:hsql://localhost:16000/sqoop --exec customer_import
            </command>  <!-- get data from MySQL RDBMS using Sqoop and store data at /user/maria_dev/Credit_Card_System --> 
        </sqoop>
        <ok to="hive-node-branch"/>    <!-- if everything is ok then start Hive nodes --> 
        <error to="sqoop-fail"/>
    </action>




   
    <action name = "hive-branch-node">
        <hive xmlns = "uri:oozie:hive-action:0.4">
            <job-tracker>${jobTracker}</job-tracker>
            <name-node>${nameNode}</name-node>
            <script>${nameNode}/user/maria_dev/Credit_Card_System/branch.hql</script>
        </hive>
        <ok to = "hive-cc-node" />
        <error to = "hive-branch-fail" />
    </action>


   
    <action name = "hive-cc-node">
        <hive xmlns = "uri:oozie:hive-action:0.4">
        <job-tracker>${jobTracker}</job-tracker>
            <name-node>${nameNode}</name-node>
            <script>${nameNode}/user/maria_dev/Credit_Card_System/credit_card.hql</script>
        </hive>
        <ok to = "hive-customer-node" />
        <error to = "hive-cc-fail" />
    </action>

  
      
    <action name = "hive-customer-node">
        <hive xmlns = "uri:oozie:hive-action:0.4">
            <job-tracker>${jobTracker}</job-tracker>
            <name-node>${nameNode}</name-node>
            <script>${nameNode}/user/maria_dev/Credit_Card_System/customer.hql</script>
        </hive>
        <ok to = "hive-time-node" />
        <error to = "hive-customer-fail"/>
    </action>
   


    <action name = "hive-time-node">
        <hive xmlns = "uri:oozie:hive-action:0.4">
            <job-tracker>${jobTracker}</job-tracker>
            <name-node>${nameNode}</name-node>
            <script>${nameNode}/user/maria_dev/Credit_Card_System/time.hql</script>
        </hive>
        <ok to = "end" />
        <error to = "hive-time-fail" />
    </action>





    <kill name = "sqoop-fail"><message>Sqoop Job failed - one of your sqoop jobs contains an error</message></kill>
    <kill name = "hive-branch-fail"><message>Hive process for Branch table failed</message></kill>
    <kill name = "hive-cc-fail"><message>Hive process for Transactions table failed</message></kill>
    <kill name = "have-customer-fail"><message>Hive process for Customers table failed</message></kill>
    <kill name = "hive-time-fail"><message>Hive process for Time table failed</message></kill>
	

    <end name = "end" />
</workflow-app>



















