
// 2.2 Functional Requirements â€“ ETL of Data
// 2.2.1 Data Extraction and Transportation with Sqoop
// Utilize Sqoop to extract Credit Card System data according to the specifications found in the mapping document:





// ////// WE ARE NO LONGER DOING THIS / Sqoop creates the directories for you when you specify target-dir
// A - set up external tables file structure where we will Sqoop data from RDBMS to be partitioned and loaded into Hive

// 1. in File View, navigate to /user/maria_dev (or whatever user you may chose to use) and create a new directory "Credit_Card_System"
// 2. inside that folder, create the following new directories
// 		CDW_SAPP_BRANCH
// 		CDW_SAPP_CREDICARD
// 		CDW_SAPP_TIME
// 		CDW_SAPP_CUSTOMER
// ////// WE ARE NO LONGER DOING THIS / Sqoop creates the directory for you when you specify target-dir





// A - Set up MySQL configuration to use Sqoop on RDBMS

$ mysql -u root -p		// log into MySQL on Putty (Sandbox cli)
$ password		// type in the password for root user 
mysql> show databases;		// list your databases
mysql> use CDW_SAPP;		// select the database we'll use
mysql> show tables;		// you can show tables, but don't you already know them by this point!?
mysql> grant all privileges on CDW_SAPP.* to ''@'localhost';		// grant all privileges so we can do work between HDFS and this database







// B - Sqoop data from RDBMS to the respective target directories in Hadoop according to Mapping Document

// 1. Sqoop data for CDW_SAPP_BRANCH

sqoop import 
--connect jdbc:mysql://localhost/CDW_SAPP 
--driver com.mysql.jdbc.Drive -m1
--target-dir /user/maria_dev/Credit_Card_System/CDW_SAPP_BRANCH
--query 'SELECT branch_code,
				branch_name,
				branch_street,
				branch_city,
				branch_state,
				IFNULL(branch_zip, 99999),
				CONCAT('(', SUBSTRING(branch_phone, 1, 3), ')', SUBSTRING(branch_phone, 4, 3), '-', SUBSTRING(branch_phone, 7, 4)) 'branch_phone'
				last_updated
			FROM CDW_SAPP_BRANCH'


// 2. Sqoop data for CDW_SAPP_CREDICARD

sqoop import 
--connect jdbc:mysql://localhost/CDW_SAPP 
--driver com.mysql.jdbc.Drive -m1
--target-dir /user/maria_dev/Credit_Card_System/CDW_SAPP_CREDICARD
--query 'SELECT transaction_id,
				cust_cc_no,
				CONCAT(year, month, day) 'time_id',
				cust_ssn,
				branch_code,
				transaction_type
				transaction_value
			FROM CDW_SAPP_CREDICARD'


// 3. Sqoop data for CDW_SAPP_CUSTOMER

sqoop import 
--connect jdbc:mysql://localhost/CDW_SAPP 
--driver com.mysql.jdbc.Drive -m1
--target-dir /user/maria_dev/Credit_Card_System/CDW_SAPP_CUSTOMER
--query 'SELECT ssn,
				CONCAT(UPPER(SUBSTRING(first_name, 1, 1)), LOWER(SUBSTRING(first_name, 2, LENGTH(first_name)))) 'first_name',
				LOWER(middle_name),
				select CONCAT(UPPER(SUBSTRING(last_name, 1, 1)), LOWER(SUBSTRING(last_name, 2, LENGTH(last_name)))) 'last_name',
				credit_card_no,
				CONCAT(street_name, ', ', apt_no) 'cust_street',
				cust_city,
				cust_state,
				cust_country,
				CAST(cust_zip, NUMBER),
				CONCAT(SUBSTRING(cust_phone, 1, 3), '-', SUBSTRING(cust_phone, 4, 4)) 'cust_phone',
				cust_email
				last_updated
			FROM CDW_SAPP_CUSTOMER'


// 4. Sqoop data for CDW_SAPP_TIME

sqoop import 
--connect jdbc:mysql://localhost/CDW_SAPP 
--driver com.mysql.jdbc.Drive -m1
--target-dir /user/maria_dev/Credit_Card_System/CDW_SAPP_TIME
--query 'SELECT CONCAT(year, month, day) 'time_id',
				day,
				month,
				year,
				CASE
					WHEN year <= 3 THEN quarter1
					WHEN year <= 6 THEN quarter2
					WHEN year <= 9 THEN quarter3
					WHEN year <= 12 THEN quarter4
				END
			FROM CDW_SAPP_CREDICARD'
















